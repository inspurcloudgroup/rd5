> 2019年5月22日

<a name="sXKiU"></a>
# Linux 用户与权限

- 用户：因为 Linux 是个多用户多任务的分时操作系统，想要调用系统资源必须先向系统管理员申请一个账号，通过用户身份进入系统。
- 用户组：用户组是具有相同特征的用户的逻辑集合。将用户分组是 Linux 系统中对用户进行管理及控制访问权限的一种手段，通过定义用户组，在很大程度上简化了管理工作。
<a name="UraDg"></a>
## 用户信息文件（/etc/passwd）
用户信息是被保存在 `/etc/passwd` 文件中，可以通过 `cat /etc/passwd` 来查看文件的内容。<br />文件中每行记录用冒号“:”分隔为 7 个字段，从左到右具体含义是：用户名 : 密码占位符（x 表示用户需要密码登录） : 用户标识号（UID） : 组标识号（GID） : 注释性描述 : 主目录 : 登录的 shell

用户信息文件中的密码信息是被单独保存在 `/etc/shadow` 文件中，文件格式和用户信息类似。<br />文件中每行记录用冒号“:”分隔为 9 个字段，从左到右具体含义是：用户名 : 加密口令 : 最后一次修改时间 : 密码最短有效天数 : 密码最长有效天数 : 密码过期前的警告时间 : 不活动时间 : 用户失效时间 : 暂时保留未使用
<a name="wKWxd"></a>
## 用户组文件（/etc/group）
Linux 系统对用户组的所有信息被保留在 `/etc/group` 文件中， 同样通过 `cat /etc/group` 命令来查看。<br />文件中每行记录用冒号“:”分隔为 4 个字段，从左到右具体含义是： 组名 : 口令 : 组标识号（GID） : 组内用户列表（多用户可用逗号分隔开）
<a name="k3DhS"></a>
## 创建用户
添加新的用户账号是通过 `useradd` 命令。
<a name="mjEWo"></a>
### 语法
```bash
useradd [选项] [用户名]
```
<a name="KDUjY"></a>
### 说明选项
| 选项 | 说明 |
| --- | --- |
| `-c` | comment，指定一段注释性描述 |
| `-d` | 目录，指定用户主目录或者说家目录；如果此目录不存在，则同时使用 -m 选项来创建主目录 |
| `-g` | 用户组，指定用户所属的用户组 |
| `-G` | 用户组，指定用户所属的附加组 |
| `-s` | Shell 文件，指定用户的登录 shell |
| `-u` | 用户号，指定用户的用户号，若有 -o 选项，则可以重复使用其它用户的标识号 |

`passwd` 命令可以用于设置用户的密码，同时也可以用于修改用户的密码，设置用户密码过期等操作，非管理员用户即一般用户只能变更自己的密码。

通常情况下，可以通过 `usermod` 来修改已经存在用户信息。<br />语法： `usermod [选项] [用户名]` <br />常用选项包括 `-c、-d、-m、-g、-G、-s、-u、-o` 等，选项用法与 `useradd` 相同。
<a name="eGTja"></a>
## 删除用户
从系统中删除一个不再使用的用户，可以通过 `userdel` 命令实现。<br />语法：
```bash
userdel [选项] [用户名]
```
选项 `-r` 用于把用户的主目录一起删除。
<a name="mnl5g"></a>
## 查看用户
在 Linux 终端里，我们先来查看一下 `/etc/passwd` 文件。第三个参数为 5000 以上的就是我们后来建立的用户，其它的是系统用户。
```bash
# 查看当前用户
w

# 查看主机上的用户
who
whoami

# 查看登录记录
lastlog

# 查看用户 id 和组信息
id
```
<a name="NYxWJ"></a>
## 管理用户组
用户组的管理和用户的管理相类似，主要包括：用户组的添加、删除和修改以及用户组间切换的权限。其中用户组的增删改实际上就是对 `/etc/group` 文件的处理。

增加新用户组： `groupadd [选项] [用户组]` 

| 选项 | 说明 |
| --- | --- |
| `-g` | 指定新用户组的组标识号（GID），该参数指定的值必须唯一 |
| `-o` | 与 `-g` 同时使用，允许用户组的新 GID 和系统已有用户组的相同 |

修改用户组： `groupmod [选项] [用户组]` 

| 选项 | 说明 |
| --- | --- |
| `-g` | 为用户组指定一个新的组标识号 |
| `-o` | 与 `-g` 同时使用时，允许将组 GID 更改为非唯一值 |
| `-n` | 将用户组的名字修改为新的名字 |

删除用户组： `groupdel 用户组` 

查看用户所属的所有组： `groups` 
<a name="MVnwY"></a>
## 用户的禁用和恢复登录
禁用：
```bash
# usermod -L username
# passwd -l username
```
恢复：
```bash
# usermod -U username
# passwd -u username
```

